<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="description" content="{}">
		<script>
			const svgns = "http://www.w3.org/2000/svg";
			let audio = (ctx = null);
			setTimeout(async () => (audio = await (await fetch("remix.mp3")).arrayBuffer()), 0);
			setTimeout(async () => (keyframes = await (await fetch("keyframes.json")).json()), 0);
			let replacements = [[], [["Ob", "In"]], [["( \\w{2})\\w+", "$1"]], [["\\b]", "ion]"]], [["\\b]", "ive]"]]];
			document.title = {};
			document.querySelector('meta[name^="d"]').content = {};
			async function init() {
				document.body.onclick = null;
				ctx = new AudioContext();
				source = ctx.createBufferSource();
				source.buffer = await ctx.decodeAudioData(audio);
				source.startTime = ctx.currentTime;
				source.loop = 1;
				source.connect(ctx.destination);
				source.start();
				beathandler();
			}
			function beathandler() {
				beat = Math.round((ctx.currentTime - source.startTime) * 26 / 3);
				if (beat % 4 == 0) updateColorScheme();
				updateText(keyframes[beat++ % keyframes.length]);
				setTimeout(beathandler, (++beat * 3 / 26 - ctx.currentTime) * 1000);
			}
			function updateColorScheme(s = document.body.style) {
				let prev = parseFloat(s.getPropertyValue("--hue")) || Math.random() * 360,
					next = prev + 60 + Math.random() * 240;
				s.setProperty("--hue", Math.floor(100 * next % 36000) / 100);
			}
			function updateText(data) {
				if (data == null) return;
				let g = document.getElementsByTagName('g')[0];
				while (g.childElementCount > data.length) g.removeChild(g.lastChild);
				while (g.childElementCount < data.length) g.appendChild(document.createElementNS(svgns, 'text'));
				let tt = data.some(k => k?.t) ? data.filter(k => k?.t)[0].t : 0;
				for (let [i, item] of data.entries()) {
					let text = g.children[i];
					if (!item) continue;
					text.textContent = (replacements[tt] || []).reduce((a, c) => a.replaceAll(new RegExp(c[0], 'g'), c[1]), '' + {});
					for (let l of ['x', 'y', 'z']) {
						if (item[l] == undefined) continue;
						text.style.setProperty('--' + l, item[l]);
					}
				}
			}
		</script>
		<style>
			html, body, svg {
				color-scheme: dark;
				height: 100%;
				overflow: visible;
				position: absolute;
				width: 100%;
			}
			body {
				background: hwb(calc(1deg * var(--hue)) 0 90);
				fill: hwb(calc(1deg * var(--hue)) 0 0);
				font-family: "Impact";
				font-size: calc(100vw/6);
				margin: 0;
				overflow: hidden;
				stroke: hwb(calc(1deg * var(--hue)) 0 50);
				text-wrap: nowrap;
				&:not([style]) {
					animation: rotateHue 11s infinite;
					background-blend-mode: overlay;
					background-image: linear-gradient(0deg, #f00, #0f0), linear-gradient(120deg, #f00, #00f), linear-gradient(240deg, #0f0, #00f), radial-gradient(#fff, #000);
				}
			}
			text {
				dominant-baseline: middle;
				filter: drop-shadow(0 0 0.05ch hwb(calc(1deg * var(--hue)) 30 0/75%));
				font-size: min(var(--z)*1em, 100vh);
				paint-order: stroke;
				stroke-width: 0.16ch;
				text-anchor: middle;
				text-shadow: 0 0 0.2ch black;
				translate: calc(100%*var(--x) + 3em - 6em*var(--x)) calc(100%*var(--y) + 1ch - 1.9ch*var(--y));
				--x: 0.5;
				--y: 0.5;
				--z: 1;
			}
			@keyframes rotateHue {
				from {
					background-color: #974;
				}
				33.3% {
					background-color: #848;
				}
				66.7% {
					background-color: #487;
				}
				100% {
					background-color: #974;
				}
			}
		</style>
	</head>
	<body onclick="init()">
		<svg>
			<filter id="equalize-brightness">
				<feColorMatrix type="saturate" values="0" result="gray"/>
				<feBlend mode="color" in="SourceGraphic" in2="gray"/>
			</filter>
			<g><text></text></g>
		</svg>
	</body>
</html>
